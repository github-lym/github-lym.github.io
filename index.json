[{"body":"","link":"https://example.com/","section":"","tags":null,"title":""},{"body":"","link":"https://example.com/post/2022/","section":"post","tags":null,"title":""},{"body":"","link":"https://example.com/post/","section":"post","tags":null,"title":""},{"body":"","link":"https://example.com/tags/mssql/","section":"tags","tags":null,"title":"MSSQL"},{"body":"","link":"https://example.com/tags/","section":"tags","tags":null,"title":"Tags"},{"body":"當時臨時接到這個要求。\n先掛載到Server\nTip\r因Express無法掛超過10GB，請用其他進階版本。\n\r1USE[master]2GO3CREATEDATABASE[tms01p141]ON4(FILENAME=N\u0026#39;D:\\DB\\tms01p141.mdf\u0026#39;),5(FILENAME=N\u0026#39;D:\\DB\\tms01p141_log.ldf\u0026#39;)6FORATTACH;7GO\rTip\r權限不夠不能執行的話請自行開放。\n\r1CREATETABLESUB(FOLDERint)--建一個臨時Table放id 23INSERTINTOSUB4SELECTTOP10--筆數條件 5B.idasFOLDER6FROM7BinderasB,8DocumentasD,9Document_AttachmentasDA,10AttachmentasA11Where12B.currentDoc_id=D.id13ANDD.id=DA.doc_id14ANDDA.at_id=A.id1516DECLARE@SQLIMGVARCHAR(MAX),17@RAW_DATAVARBINARY(MAX),--檔案二進位資料欄位(存放rawdata) 18@FILENAMEVARCHAR(MAX),--檔名欄位(記錄上傳檔名) 19@PATHVARCHAR(MAX),--最底層路徑 20@FOLDERVARCHAR(MAX),--資料夾 21@FILEIDVARCHAR(MAX),--不重要 22@ObjectTokenINT,23@cmdpathnvarchar(60)--命令列 2425SET@PATH=\u0026#39;D:\\\u0026#39;--設定最底層路徑 2627--建資料夾BEGIN 28DECLAREC_SUBCURSORFAST_FORWARDFOR29SELECTFOLDERFROMSUBgroupbyFOLDER3031OPENC_SUB32FETCHNEXTFROMC_SUBINTO@FOLDER33WHILE@@FETCH_STATUS=03435BEGIN36SET@FOLDER=@PATH+@FOLDER;--設定路徑 37SET@cmdpath=\u0026#39;MD \u0026#39;+@FOLDER38EXECmaster.dbo.xp_cmdshell@cmdpath3940FETCHNEXTFROMC_SUBINTO@FOLDER41END424344CLOSEC_SUB45DEALLOCATEC_SUB46--建資料夾END 4748DECLAREFILESCURSORFAST_FORWARDFOR49SELECTTOP10--筆數條件 50B.idasFOLDER,A.idasFileId,A.fileNameasFILENAME,A.rawDataasRAW_DATA51FROM52BinderasB,DocumentasD,Document_AttachmentasDA,AttachmentasA53Where54B.currentDoc_id=D.id55ANDD.id=DA.doc_id56ANDDA.at_id=A.id---選擇欲轉出的資料(選擇rawdata跟檔名欄位) 575859OPENFILES6061FETCHNEXTFROMFILESINTO@FOLDER,@FILEID,@FILENAME,@RAW_DATA6263WHILE@@FETCH_STATUS=064BEGIN6566SET@FOLDER=@PATH+@FOLDER;--設定路徑 67--SET @cmdpath = \u0026#39;MD \u0026#39; + @FOLDER 68--EXEC master.dbo.xp_cmdshell @cmdpath 69SET@FILENAME=@FOLDER+\u0026#39;\\\u0026#39;+@FILENAME7071PRINT@FILENAME72--PRINT @SQLIMG 7374EXECsp_OACreate\u0026#39;ADODB.Stream\u0026#39;,@ObjectTokenOUTPUT75EXECsp_OASetProperty@ObjectToken,\u0026#39;Type\u0026#39;,176EXECsp_OAMethod@ObjectToken,\u0026#39;Open\u0026#39;77EXECsp_OAMethod@ObjectToken,\u0026#39;Write\u0026#39;,NULL,@RAW_DATA78EXECsp_OAMethod@ObjectToken,\u0026#39;SaveToFile\u0026#39;,NULL,@FILENAME,279EXECsp_OAMethod@ObjectToken,\u0026#39;Close\u0026#39;80EXECsp_OADestroy@ObjectToken8182FETCHNEXTFROMFILESINTO@FOLDER,@FILEID,@FILENAME,@RAW_DATA83END8485CLOSEFILES86DEALLOCATEFILES8788DROPTABLESUB","link":"https://example.com/post/2022/covert-to-files-from-mssql/","section":"post","tags":["MSSQL"],"title":"將MSSQL Table的Binary檔轉出"},{"body":"不學無術，混死等死，記憶衰退，只能把可能有用的東西記錄下來。 \r\r\r\r","link":"https://example.com/about/","section":"","tags":null,"title":"About"},{"body":"","link":"https://example.com/tags/trifles/","section":"tags","tags":null,"title":"trifles"},{"body":"就試看看吧？\n年紀越大記憶力越差，\n想記錄一些可能曾經碰過或可能會用得到的東西，算是敝帚自珍吧！ \r\r\r\r","link":"https://example.com/post/2022/first-post/","section":"post","tags":["trifles"],"title":"第一篇"},{"body":"","link":"https://example.com/archives/","section":"","tags":null,"title":""},{"body":"","link":"https://example.com/categories/","section":"categories","tags":null,"title":"Categories"},{"body":"","link":"https://example.com/series/","section":"series","tags":null,"title":"Series"}]