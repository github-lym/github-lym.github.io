[{"content":"剛進公司是駐點在公家機關做客服工程師，每天接電話回答系統問題。\n除此之外，每天下班為了流程都必須更新該機關組織圖。\n前輩寫了一個很神的程式，他寫的vbs可以去抓資料庫的資料，\n並產生新的SQL指令(文字檔)可以更新組織圖。\n所以我們每天會檢查有異動的組織，產生該組織的SQL更新指令。 這產生的問題比較麻煩的點有兩個：\n1. 有時資料庫連不上或是一些我不知道的理由，產生的SQL指令並不完全。 2. 要開啟多個文字檔執行SQL指令，頗浪費時間。做完一整套常花快一個鐘頭。  於是，我的懶人病發作了，就寫了進公司的第一支程式。\n一開始很單純，既然程式在有異動單位的資料夾產生*.SQL檔，\n那我把子資料夾的檔案合併成一個再來執行就好。\n於是生成了這個。\n雖省了一些時間，但並沒解決上述第一個問題。\n上圖後來東問西抄問人寫出來的第三版。\n比以前的作業方式簡單又可檢查未產生的檔案並重新產出，\n以前產生百個檔案以上無法一一檢查的問題迎刃而解，\n使用這版本以來，不再有未產出檔案的事發生。\n但僅適用於本人上班場所，泛用性不高。\n不過省了很多時間，本來一小時的操作變為大約20分鐘左右就搞定下班了。\n","permalink":"https://github-lym.github.io/posts/2022/%E6%89%B9%E6%AC%A1%E5%9F%B7%E8%A1%8Cvbs%E6%AA%94%E4%B8%A6%E6%AA%A2%E6%9F%A5%E7%B5%90%E6%9E%9C/","summary":"\u003cp\u003e剛進公司是駐點在公家機關做客服工程師，每天接電話回答系統問題。\u003c/p\u003e\n\u003cp\u003e除此之外，每天下班為了流程都必須更新該機關組織圖。\u003c/p\u003e","title":"批次執行vbs檔並檢查結果"},{"content":"當時臨時接到這個要求。\n先掛載到Server\n 因Express無法掛超過10GB，請用其他進階版本。\n USE[master]GOCREATEDATABASE[tms01p141]ON(FILENAME=N\u0026#39;D:\\DB\\tms01p141.mdf\u0026#39;),(FILENAME=N\u0026#39;D:\\DB\\tms01p141_log.ldf\u0026#39;)FORATTACH;GO 權限不夠不能執行的話請自行開放。\n CREATETABLESUB(FOLDERint)--建一個臨時Table放id INSERTINTOSUBSELECTTOP10--筆數條件 B.idasFOLDERFROMBinderasB,DocumentasD,Document_AttachmentasDA,AttachmentasAWhereB.currentDoc_id=D.idANDD.id=DA.doc_idANDDA.at_id=A.idDECLARE@SQLIMGVARCHAR(MAX),@RAW_DATAVARBINARY(MAX),--檔案二進位資料欄位(存放rawdata) @FILENAMEVARCHAR(MAX),--檔名欄位(記錄上傳檔名) @PATHVARCHAR(MAX),--最底層路徑 @FOLDERVARCHAR(MAX),--資料夾 @FILEIDVARCHAR(MAX),--不重要 @ObjectTokenINT,@cmdpathnvarchar(60)--命令列 SET@PATH=\u0026#39;D:\\\u0026#39;--設定最底層路徑 --建資料夾BEGIN DECLAREC_SUBCURSORFAST_FORWARDFORSELECTFOLDERFROMSUBgroupbyFOLDEROPENC_SUBFETCHNEXTFROMC_SUBINTO@FOLDERWHILE@@FETCH_STATUS=0BEGINSET@FOLDER=@PATH+@FOLDER;--設定路徑 SET@cmdpath=\u0026#39;MD \u0026#39;+@FOLDEREXECmaster.dbo.xp_cmdshell@cmdpathFETCHNEXTFROMC_SUBINTO@FOLDERENDCLOSEC_SUBDEALLOCATEC_SUB--建資料夾END DECLAREFILESCURSORFAST_FORWARDFORSELECTTOP10--筆數條件 B.idasFOLDER,A.idasFileId,A.fileNameasFILENAME,A.rawDataasRAW_DATAFROMBinderasB,DocumentasD,Document_AttachmentasDA,AttachmentasAWhereB.currentDoc_id=D.idANDD.id=DA.doc_idANDDA.at_id=A.id---選擇欲轉出的資料(選擇rawdata跟檔名欄位) OPENFILESFETCHNEXTFROMFILESINTO@FOLDER,@FILEID,@FILENAME,@RAW_DATAWHILE@@FETCH_STATUS=0BEGINSET@FOLDER=@PATH+@FOLDER;--設定路徑 --SET @cmdpath = \u0026#39;MD \u0026#39; + @FOLDER --EXEC master.dbo.xp_cmdshell @cmdpath SET@FILENAME=@FOLDER+\u0026#39;\\\u0026#39;+@FILENAMEPRINT@FILENAME--PRINT @SQLIMG EXECsp_OACreate\u0026#39;ADODB.Stream\u0026#39;,@ObjectTokenOUTPUTEXECsp_OASetProperty@ObjectToken,\u0026#39;Type\u0026#39;,1EXECsp_OAMethod@ObjectToken,\u0026#39;Open\u0026#39;EXECsp_OAMethod@ObjectToken,\u0026#39;Write\u0026#39;,NULL,@RAW_DATAEXECsp_OAMethod@ObjectToken,\u0026#39;SaveToFile\u0026#39;,NULL,@FILENAME,2EXECsp_OAMethod@ObjectToken,\u0026#39;Close\u0026#39;EXECsp_OADestroy@ObjectTokenFETCHNEXTFROMFILESINTO@FOLDER,@FILEID,@FILENAME,@RAW_DATAENDCLOSEFILESDEALLOCATEFILESDROPTABLESUB","permalink":"https://github-lym.github.io/posts/2022/covert-to-files-from-mssql/","summary":"\u003cp\u003e當時臨時接到這個要求。\u003c/p\u003e","title":"將MSSQL Table的Binary檔轉出"},{"content":"就試看看吧？\n年紀越大記憶力越差，\n想記錄一些可能曾經碰過或可能會用得到的東西，算是雜物儲藏庫吧！ ","permalink":"https://github-lym.github.io/posts/2022/first-post/","summary":"\u003cp\u003e就試看看吧？\u003c/p\u003e","title":"第一篇"},{"content":"不學無術，混死等死，記憶衰退，只能把可能有用的東西記錄下來。 ","permalink":"https://github-lym.github.io/about/","summary":"不學無術，混死等死，記憶衰退，只能把可能有用的東西記錄下來。 ","title":"關於我"}]