[{"content":"當時臨時接到這個要求。\n先掛載到Server\n 因Express無法掛超過10GB，請用其他進階版本。\n USE[master]GOCREATEDATABASE[tms01p141]ON(FILENAME=N\u0026#39;D:\\DB\\tms01p141.mdf\u0026#39;),(FILENAME=N\u0026#39;D:\\DB\\tms01p141_log.ldf\u0026#39;)FORATTACH;GO 權限不夠不能執行的話請自行開放。\n CREATETABLESUB(FOLDERint)--建一個臨時Table放id INSERTINTOSUBSELECTTOP10--筆數條件 B.idasFOLDERFROMBinderasB,DocumentasD,Document_AttachmentasDA,AttachmentasAWhereB.currentDoc_id=D.idANDD.id=DA.doc_idANDDA.at_id=A.idDECLARE@SQLIMGVARCHAR(MAX),@RAW_DATAVARBINARY(MAX),--檔案二進位資料欄位(存放rawdata) @FILENAMEVARCHAR(MAX),--檔名欄位(記錄上傳檔名) @PATHVARCHAR(MAX),--最底層路徑 @FOLDERVARCHAR(MAX),--資料夾 @FILEIDVARCHAR(MAX),--不重要 @ObjectTokenINT,@cmdpathnvarchar(60)--命令列 SET@PATH=\u0026#39;D:\\\u0026#39;--設定最底層路徑 --建資料夾BEGIN DECLAREC_SUBCURSORFAST_FORWARDFORSELECTFOLDERFROMSUBgroupbyFOLDEROPENC_SUBFETCHNEXTFROMC_SUBINTO@FOLDERWHILE@@FETCH_STATUS=0BEGINSET@FOLDER=@PATH+@FOLDER;--設定路徑 SET@cmdpath=\u0026#39;MD \u0026#39;+@FOLDEREXECmaster.dbo.xp_cmdshell@cmdpathFETCHNEXTFROMC_SUBINTO@FOLDERENDCLOSEC_SUBDEALLOCATEC_SUB--建資料夾END DECLAREFILESCURSORFAST_FORWARDFORSELECTTOP10--筆數條件 B.idasFOLDER,A.idasFileId,A.fileNameasFILENAME,A.rawDataasRAW_DATAFROMBinderasB,DocumentasD,Document_AttachmentasDA,AttachmentasAWhereB.currentDoc_id=D.idANDD.id=DA.doc_idANDDA.at_id=A.id---選擇欲轉出的資料(選擇rawdata跟檔名欄位) OPENFILESFETCHNEXTFROMFILESINTO@FOLDER,@FILEID,@FILENAME,@RAW_DATAWHILE@@FETCH_STATUS=0BEGINSET@FOLDER=@PATH+@FOLDER;--設定路徑 --SET @cmdpath = \u0026#39;MD \u0026#39; + @FOLDER --EXEC master.dbo.xp_cmdshell @cmdpath SET@FILENAME=@FOLDER+\u0026#39;\\\u0026#39;+@FILENAMEPRINT@FILENAME--PRINT @SQLIMG EXECsp_OACreate\u0026#39;ADODB.Stream\u0026#39;,@ObjectTokenOUTPUTEXECsp_OASetProperty@ObjectToken,\u0026#39;Type\u0026#39;,1EXECsp_OAMethod@ObjectToken,\u0026#39;Open\u0026#39;EXECsp_OAMethod@ObjectToken,\u0026#39;Write\u0026#39;,NULL,@RAW_DATAEXECsp_OAMethod@ObjectToken,\u0026#39;SaveToFile\u0026#39;,NULL,@FILENAME,2EXECsp_OAMethod@ObjectToken,\u0026#39;Close\u0026#39;EXECsp_OADestroy@ObjectTokenFETCHNEXTFROMFILESINTO@FOLDER,@FILEID,@FILENAME,@RAW_DATAENDCLOSEFILESDEALLOCATEFILESDROPTABLESUB","permalink":"https://github-lym.github.io/2022/covert-to-files-from-mssql/","summary":"\u003cp\u003e當時臨時接到這個要求。\u003c/p\u003e","title":"將MSSQL Table的Binary檔轉出"},{"content":"就試看看吧？\n年紀越大記憶力越差，\n想記錄一些可能曾經碰過或可能會用得到的東西，算是敝帚自珍吧！ ","permalink":"https://github-lym.github.io/2022/first-post/","summary":"\u003cp\u003e就試看看吧？\u003c/p\u003e","title":"第一篇"},{"content":"不學無術，混死等死，記憶衰退，只能把可能有用的東西記錄下來。 ","permalink":"https://github-lym.github.io/about/","summary":"不學無術，混死等死，記憶衰退，只能把可能有用的東西記錄下來。 ","title":"關於我"}]